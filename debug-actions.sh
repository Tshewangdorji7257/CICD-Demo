#!/bin/bash

echo "üîß GitHub Actions Debug Helper"
echo "=============================="
echo ""

echo "This script helps debug common GitHub Actions issues."
echo ""

echo "üìã Secret Verification Checklist:"
echo "--------------------------------"
echo ""
echo "1. ‚úÖ Check if SNYK_TOKEN is set:"
echo "   - Go to: https://github.com/Tshewangdorji7257/CICD-Demo/settings/secrets/actions"
echo "   - Look for: SNYK_TOKEN"
echo "   - Should show green checkmark"
echo ""

echo "2. ‚úÖ Check if SONAR_TOKEN is set:"
echo "   - Same location as above"
echo "   - Look for: SONAR_TOKEN"
echo "   - Should show green checkmark"
echo ""

echo "3. ‚úÖ Check if SONAR_ORGANIZATION is set:"
echo "   - Same location as above"
echo "   - Look for: SONAR_ORGANIZATION"
echo "   - Value should be: tshewangdorji7257"
echo ""

echo "üîç Common Issues and Solutions:"
echo "------------------------------"
echo ""

echo "Issue 1: Workflow skips security jobs"
echo "Solution: Ensure all required secrets are properly set"
echo ""

echo "Issue 2: SonarCloud authentication fails"
echo "Solution: "
echo "  - Verify SONAR_TOKEN is valid and not expired"
echo "  - Check that SonarCloud project exists"
echo "  - Project key should be: Tshewangdorji7257_CICD-Demo"
echo ""

echo "Issue 3: Snyk authentication fails" 
echo "Solution:"
echo "  - Verify SNYK_TOKEN is valid"
echo "  - Check Snyk account is active"
echo "  - Token should have appropriate permissions"
echo ""

echo "Issue 4: Build fails"
echo "Solution:"
echo "  - Check Java 17 compatibility"
echo "  - Verify Maven dependencies"
echo "  - Look at detailed error logs in Actions tab"
echo ""

echo "üéØ Quick Verification Steps:"
echo "---------------------------"
echo "1. Check the 'Basic Build Test' workflow first"
echo "2. If basic build passes, then check security workflows"
echo "3. Review workflow logs for specific error messages"
echo "4. Ensure SonarCloud project is properly configured"
echo ""

echo "üìû SonarCloud Project Setup:"
echo "---------------------------"
echo "1. Go to: https://sonarcloud.io"
echo "2. Import project: Tshewangdorji7257/CICD-Demo"
echo "3. Project key must be: Tshewangdorji7257_CICD-Demo"
echo "4. Organization: tshewangdorji7257"
echo "5. Choose 'With GitHub Actions' setup method"
echo ""

echo "üîó Useful Links:"
echo "---------------"
echo "‚Ä¢ GitHub Actions: https://github.com/Tshewangdorji7257/CICD-Demo/actions"
echo "‚Ä¢ Repository Secrets: https://github.com/Tshewangdorji7257/CICD-Demo/settings/secrets/actions"
echo "‚Ä¢ SonarCloud: https://sonarcloud.io/projects"
echo "‚Ä¢ Snyk Dashboard: https://app.snyk.io"
echo ""

echo "üí° Pro Tips:"
echo "-----------"
echo "‚Ä¢ Start with the basic-build workflow to ensure fundamentals work"
echo "‚Ä¢ Security workflows will skip if secrets are missing (not fail)"
echo "‚Ä¢ Check individual workflow logs for detailed error messages"
echo "‚Ä¢ SonarCloud project key is case-sensitive"
echo ""

echo "Happy debugging! üöÄ"